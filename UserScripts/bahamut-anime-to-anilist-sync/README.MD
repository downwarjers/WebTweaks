# Bahamut Anime to AniList Sync (巴哈姆特動畫瘋同步到 AniList)

這是一個 Tampermonkey/Violentmonkey 腳本，用於將**巴哈姆特動畫瘋**的觀看進度自動同步至 **AniList**。
主要解決巴哈姆特（依季度分開）與 AniList（通常依系列總集數或分開）集數計算方式不一致的問題，並提供完整的後台設定介面。

## 主要功能

- **自動同步**：偵測播放器進度，自動更新 AniList 觀看集數。
- **同步時機設定**：可選擇播放 5 秒後、進度 80%、播放完畢後或自訂秒數觸發。
- **系列作對應 (Series Mapping)**：
  - 這是本腳本的核心功能。當巴哈姆特標示為「第 1 集」但 AniList 實際為「第 13 集」（如第二季）時，可透過面板設定對應集數。
  - 支援多季度、OVA、特別篇的集數規則自訂。
- **自動匹配**：透過標題、開播日期與官方網站網域，自動搜尋並連結 AniList 條目。
- **介面整合**：
  - 在動畫瘋導航列整合狀態顯示。
  - 完整支援動畫瘋的深色模式 (Dark Mode)。
  - 提供圖形化介面 (GUI) 管理綁定狀態與 Token。

## 介面預覽

![介面預覽](https://i.ibb.co/GNBsXWq/1.png)

**1. 控制面板與狀態**
腳本會在導航列顯示目前的同步狀態，點擊即可開啟設定面板。
![控制面板](https://i.ibb.co/BVyndV3t/2.png)

**2. 系列作設定 (核心功能)**
若遇到集數對不上（例如第二季），請在此頁面調整「巴哈起始集數」對應「AniList 起始集數」。
![系列設定](https://i.ibb.co/0RV5Y8ZF/3.png)

**3. Token 與偏好設定**
首次使用需設定 AniList Token，並可調整同步觸發的時機。
![設定頁面](https://i.ibb.co/Nd9H0DXv/5.png)

## 安裝與設定教學

### 1. 安裝腳本

點擊頁面上方的安裝按鈕進行安裝。

### 2. 連結 AniList 帳號 (授權)

為了讓腳本能存取您的 AniList 帳號，初次使用需要進行授權。本腳本提供兩種方式，推薦使用 **方法 A**。

#### 方法 A：一鍵自動授權 (推薦)

這是最簡單快速的方式，無需手動建立 Client。

1.  在動畫瘋頁面點擊腳本選單中的「設定」或導航列圖示。
2.  在設定面板中，點擊 **「連結 AniList 帳號」** 按鈕。
3.  在彈出的視窗中登入 AniList 並點擊 **Authorize**。
4.  視窗會自動關閉，頁面將自動重新整理並顯示「✅ 已完成授權」。

#### 方法 B：手動輸入 Token (進階/備用)

如果您偏好手動建立 Client 或一鍵授權無法使用，可展開「手動輸入 Token (進階)」區塊進行設定。

1.  前往 [AniList Developer Settings](https://anilist.co/settings/developer)。
2.  點擊 **Create New Client**。
3.  名稱隨意，Redirect URL 請填寫：`https://anilist.co/api/v2/oauth/pin`。
4.  儲存後取得 **Client ID**。
5.  回到動畫瘋腳本設定面板，展開手動輸入區塊。
6.  輸入 Client ID 並點擊「前往授權」。
7.  將取得的 Access Token 貼回腳本輸入框，並點擊最下方的「儲存設定」。

### 3. 開始使用

進入動畫播放頁面，腳本會嘗試自動匹配。

- **匹配成功**：圖示顯示 ✅，並自動開始同步。
- **集數錯誤**：請點開面板進入「系列設定」，檢查該季度的起始集數是否正確。
- **匹配失敗**：可使用面板中的搜尋功能手動綁定作品。

## 隱私與安全性

- **本地儲存**：您的 AniList Access Token 僅儲存在您瀏覽器的本地端 (Local Storage)，**絕不會**傳送給除了 AniList API 以外的任何第三方伺服器。
- **開源透明**：本腳本為完全開源專案，您可以隨時檢視程式碼以確保安全。

## 故障排除

如果遇到同步沒反應或狀態錯誤，請嘗試以下步驟：

1.  **重新整理頁面**：有時候腳本載入順序會受網路影響。
2.  **檢查 Token**：若出現 Token 錯誤圖示，請嘗試重新取得並儲存新的 Token。
3.  **手動刷新**：點擊面板中的「🔄 刷新」按鈕強制重新抓取資料。
